
    <%- include('./partials/header') %>
    <style>
    body{
        background-color: black;
    }
    #navbar{
           margin-bottom: 1%;
        }
        .like{
            transition: 1s;
            border-radius: 50%;
            width: 100%; 
            height: 100%; 
            font-size: 200%;
            outline: none;
            box-shadow: 0 0 0 5px rgba(0, 0, 0, 0.616);
            text-shadow: 1px 1px 1px 5px red;
            border: 2px dotted rgba(0, 0, 0, 0.616);
            
        }
        .like:hover, .liked:hover{
            cursor: pointer; 
        }
        .liked{
            transition: 1s;
            border-radius: 50%;
            width: 100%; 
            height: 100%; 
            font-size: 200%;
            outline: none;
            background-color: black;
            color: red;
            border: 2px dotted rgba(202, 66, 66, 0.767) ;
            box-shadow: 0 0 0 4px rgba(36, 19, 19, 0.767);
        }
        
    </style>
    
        <% if (posts.length){ %>
            <% posts.forEach ( (post,postIdx) => {%>
            <div id="post-container">
                <div id="user-information">
                    <div id="profile-pic" style="background-image: url('<%= post.userAvatar%>');" ></div>
                    <a style="color: white; text-decoration: none;" href="/users/<%= post.userId%>"> <h2><%= post.username%></h2></a>
                </div>
                <div id="post-holder">
                    <div id="post-pic"><img id="image" src="<%= post.image%>" alt=""></div>
                    <div>

                        <button name="<%= post._id%>" id="<%= loggedInUser._id%>" class="<%= !post.likes.includes(loggedInUser._id) ? 'like' : 'liked'%>"  >
                            
                            ❤</button>
                        
                        <p style="color: white;">  <span id="<%= post._id%>"><%= post.likes.length%></span>  likes</p>


                    </div>
                    <div id="caption-holder">
                            <div id="car-information"><h2 style="font-size: 35px;font-family: 'Arvo', serif;"> <span><%= post.brand%> </span><span> <%= post.model%> </span><span> <%= post.year%><h2></span>
                        <h2 style="font-family: 'Arvo', serif;font-size: 30px;"><%= post.horsePower %> hp  <span> <%= post.engine %></h2></div>
                        <h2 style="font-family: 'Arvo', serif;"><%= post.caption%></h2>    
                    </div>
                </div>
                <div  id="comments-holder">
                        <% if (post.comments.length){%>
                            <%post.comments.forEach ((comment, index) => {%>
                                <% if (comment.visitorId == loggedInUser._id){%>
                                    <div class="logged-in-user-comment" style="width: 100%; margin-left: 0; border: 1px solid rgb(0, 0, 0);">
                                            <div class="commenter-information">
                                                <div class="icon-holder" style="background-image: url('<%= loggedInUser.avatar %>');"></div></a>
                                                <a style="color: white; text-decoration: none;" href="/users/profile/<%= loggedInUser._id%>"> <%= loggedInUser.name%></a>
                                                <span style="color: red; font-size: 20px;"> : </span>
                                            </div>
                                        <p style=" width: 85%; margin-left: 1%;"> <%= comment.comment%></p>
                                        <form class="comment-delete-form" action="/posts/comment/<%= post._id%>?_method=DELETE&commentIdx=<%= index %>" method="POST">
                                            <input id="remove" type="submit" value="✘" >
                                        </form>
                
                                    </div>
                                <%} 
                
                                else {%>
                
                                    <div class="logged-in-user-comment" style="width: 100%; margin-left: 0; border: 1px solid rgb(0, 0, 0);">
                                        <div class="commenter-information" >
                                        <div class="icon-holder" style="background-image: url('<%= comment.visitorAvatar %>');"></div></a>
                                        <a style="color: white; text-decoration: none;" href="/users/<%= comment.visitorId%>"> <%= comment.visitorName%> </a>
                                        <span style="color: red; font-size: 20px;"> : </span>
                                    </div>
                                    <p style=" width: 88%; margin-left: 1%;"> <%= comment.comment%></p>
                                    </div>
                
                                <% }%>
                
                            <%})%>
                        <%};%>
                    </div>

                <div id="new-comment-holder">
                        <form id="new-comment-form" action="/posts/comment/<%= post._id%>?postId=<%= post._id %>" method="POST">
                            <input style=" margin-left: .5%;" required id="comment-input" type="text" placeholder="comment ..." name="comment">
                            <button type="submit"> ✉ </button>
                        </form>
            <% }) ;%>    


           
           

        </div>
        <%};%>
    

<!-- <div>Icons made by <a href="https://www.flaticon.com/authors/smashicons" title="Smashicons">Smashicons</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div> -->
<!-- <div>Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div> -->

<script>
    $( '.like, .liked').on('click',async function(evt){
        console.log(evt.target)
        var like = document.getElementsByName(`${evt.target.name}`)
        var likesNumber = document.getElementById(`${evt.target.name}`)
        $(like).toggleClass('like')
        $(like).toggleClass('liked')
        if(evt.target.className === 'liked') likesNumber.innerHTML = `${parseInt(likesNumber.innerHTML)+1}`
        if(evt.target.className === 'like') likesNumber.innerHTML = `${parseInt(likesNumber.innerHTML)-1}`
        fetch(`/likes/${evt.target.id}/${evt.target.name}`)
        .then(res => {
           return res.json()  
        })
        .then(data => {
            console.log(data)
        })
    })
</script>
<%- include('./partials/footer') %>
